(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{403:function(t,a,e){"use strict";e.r(a);var _=e(44),r=Object(_.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"更新日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新日志"}},[t._v("#")]),t._v(" 更新日志")]),t._v(" "),e("h2",{attrs:{id:"未发布"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#未发布"}},[t._v("#")]),t._v(" [未发布]")]),t._v(" "),e("h3",{attrs:{id:"新增"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("h3",{attrs:{id:"移除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除"}},[t._v("#")]),t._v(" 移除")]),t._v(" "),e("h3",{attrs:{id:"变动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("提升了 CC 防护的性能。")])]),t._v(" "),e("h3",{attrs:{id:"修复"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("极端情况下可能会造成大量的内存浪费。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_6-0-0-2021-07-21-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-0-0-2021-07-21-utc-0800"}},[t._v("#")]),t._v(" [6.0.0] - 2021-07-21 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"注意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("本次更新有一些不向下兼容的改动。")])])]),t._v(" "),e("li",[e("p",[t._v("高级规则的执行速度较慢，因为其原理是将规则编译成一系列指令，然后由虚拟机执行。")])])]),t._v(" "),e("h3",{attrs:{id:"预构建模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预构建模块"}},[t._v("#")]),t._v(" 预构建模块")]),t._v(" "),e("p",[t._v("现在我们提供了提前编译好的模块，只要满足了下列要求即可使用。")]),t._v(" "),e("ol",[e("li",[t._v("nginx 的版本必须是最新的 stable 或 mainline 版本。")]),t._v(" "),e("li",[t._v("您使用的 C 语言的标准库实现必须是 GNU 实现或者 musl 实现。")])]),t._v(" "),e("blockquote",[e("p",[t._v("下载脚本会自动检查是否满足第二个条件。")])]),t._v(" "),e("p",[t._v("您可以执行 "),e("code",[t._v("assets/download.sh")]),t._v(" 来下载对应版本的模块并保存到当前目录。下面是用例。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-stable ngx_waf-stable")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" assets/download stable stable\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-mainline ngx_waf-stable")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" assets/download mainline stable\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-stable ngx_waf-beta")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" assets/download stable beta\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-mainline ngx_waf-beta")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" assets/download mainline beta\n")])])]),e("blockquote",[e("p",[t._v("每次更新都需要花费约一个半小时的时间来编译模块，所以推荐在更新超过两个小时后再下载更新后的模块，否则可能会下载到旧的模块。")])]),t._v(" "),e("h3",{attrs:{id:"从-5-x-x-升级到-6-x-x"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从-5-x-x-升级到-6-x-x"}},[t._v("#")]),t._v(" 从 5.x.x 升级到 6.x.x")]),t._v(" "),e("ol",[e("li",[t._v("在规则目录下新建一个名为 "),e("code",[t._v("advanced")]),t._v(" 的空文件。")]),t._v(" "),e("li",[t._v("如果使用了配置项 "),e("code",[t._v("waf_priority")]),t._v("，可以将其删除或者按照文档中对该配置项的说明进行修改。")])]),t._v(" "),e("h3",{attrs:{id:"新增-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-2"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("支持了高级规则，详情见文档。")])]),t._v(" "),e("h3",{attrs:{id:"移除-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除-2"}},[t._v("#")]),t._v(" 移除")]),t._v(" "),e("ul",[e("li",[t._v("移除 "),e("code",[t._v("COMPAT")]),t._v(" 模式，不再完全兼容 "),e("code",[t._v("ngx_http_rewrite_module")]),t._v("。")])]),t._v(" "),e("h3",{attrs:{id:"变动-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-2"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("更新了配置项 "),e("code",[t._v("waf_priority")]),t._v("，详情见文档。")])]),t._v(" "),e("li",[e("p",[t._v("现在你可以在 "),e("code",[t._v("http")]),t._v("、"),e("code",[t._v("server")]),t._v(" 和 "),e("code",[t._v("location")]),t._v(" 块中使用本模块的所有配置项。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-5-1-2021-07-16-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-2021-07-16-utc-0800"}},[t._v("#")]),t._v(" [5.5.1] - 2021-07-16 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-2"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("段错误。")])]),t._v(" "),e("li",[e("p",[t._v("内存泄漏。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-5-0-2021-06-25-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-0-2021-06-25-utc-0800"}},[t._v("#")]),t._v(" [5.5.0] - 2021-06-25 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"变动-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-3"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("在工作模式 "),e("code",[t._v("STD")]),t._v(" 和 "),e("code",[t._v("DYNAMIC")]),t._v(" 中禁用了基于 "),e("code",[t._v("libinjection")]),t._v(" 的 XSS 攻击检测，因为有用户反映误报比较高。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-4-2-2021-06-15-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-2-2021-06-15-utc-0800"}},[t._v("#")]),t._v(" [5.4.2] - 2021-06-15 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-3"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("如果启用了 POST 检测，则访问日志（access_log）中不会记录 POST 请求，即丢失所有的 POST 请求的日志。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-4-1-2021-06-09-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-2021-06-09-utc-0800"}},[t._v("#")]),t._v(" [5.4.1] - 2021-06-09 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-4"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("当使用了 "),e("code",[t._v("error_page")]),t._v(" 配置时，内置变量的值可能会出错。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-4-0-2021-06-03-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-0-2021-06-03-utc-0800"}},[t._v("#")]),t._v(" [5.4.0] - 2021-06-03 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"注意-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意-2"}},[t._v("#")]),t._v(" "),e("strong",[t._v("注意")])]),t._v(" "),e("p",[e("strong",[t._v("本次更新更换了 libinjection 的 clone 链接，新的链接为 "),e("a",{attrs:{href:"https://github.com/libinjection/libinjection.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/libinjection/libinjection.git"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("h3",{attrs:{id:"新增-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-3"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("XSS 攻击防御（Powered By "),e("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[t._v("libinjection"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"变动-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-4"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("增加内置变量计算相关的调试日志。")])]),t._v(" "),e("h3",{attrs:{id:"修复-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-5"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("POST 检测失效。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-3-2-2021-05-28-utc-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-2021-05-28-utc-0800"}},[t._v("#")]),t._v(" [5.3.2] - 2021-05-28 UTC+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-6"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("内存损坏。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-3-1-2021-05-26-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-2021-05-26-gmt-0800"}},[t._v("#")]),t._v(" [5.3.1] - 2021-05-26 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-7"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("有时即使正确安装了依赖也不能编译模块。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-3-0-2021-05-16-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-0-2021-05-16-gmt-0800"}},[t._v("#")]),t._v(" [5.3.0] - 2021-05-16 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"新增-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-4"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("新的配置："),e("code",[t._v("waf_under_attack")]),t._v("，当网站受到攻击时可以使用。")])]),t._v(" "),e("li",[e("p",[t._v("新的配置："),e("code",[t._v("waf_http_status")]),t._v("，用于设置请求被拦截后返回的 HTTP 状态码。")])]),t._v(" "),e("li",[e("p",[t._v("新的内置变量："),e("code",[t._v("$waf_blocking_log")]),t._v("，当请求被拦截其值时不为空字符串。")])])]),t._v(" "),e("h3",{attrs:{id:"变动-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-5"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("更新了默认规则。")])]),t._v(" "),e("h3",{attrs:{id:"修复-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-8"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("CC 防护有时会失效。")])]),t._v(" "),e("li",[e("p",[t._v("Cookie 防护有时会失效。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-1-2-2021-04-30-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-2021-04-30-gmt-0800"}},[t._v("#")]),t._v(" [5.1.2] - 2021-04-30 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"新增-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-5"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("支持检测 SQL 注入（Powered By "),e("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[t._v("libinjection"),e("OutboundLink")],1),t._v("）。你可以通过启用 "),e("code",[t._v("LIB-INJECTION")]),t._v(" 模式开启该功能，详见使用文档。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-1-1-2021-04-23-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-2021-04-23-gmt-0800"}},[t._v("#")]),t._v(" [5.1.1] - 2021-04-23 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"修复-9"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-9"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("URL 和 Referer 白名单规则失效。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-1-0-2021-04-20-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-0-2021-04-20-gmt-0800"}},[t._v("#")]),t._v(" [5.1.0] - 2021-04-20 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"新增-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-6"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("新的内置变量 "),e("code",[t._v("waf_log")]),t._v("，当本模块进行了检查时不为空字符串，反之则为空字符串，主要用于 "),e("code",[t._v("access_log")]),t._v(" 指令。")])]),t._v(" "),e("li",[e("p",[t._v("新的内置变量 "),e("code",[t._v("waf_spend")]),t._v("，记录本模块执行检查花费的时间（毫秒）。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_5-0-0-2021-04-07-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-0-2021-04-07-gmt-0800"}},[t._v("#")]),t._v(" [5.0.0] - 2021-04-07 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"警告"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#警告"}},[t._v("#")]),t._v(" "),e("strong",[t._v("警告")])]),t._v(" "),e("p",[e("strong",[t._v("此版本包含不兼容的更新（breaking changes）。")])]),t._v(" "),e("h3",{attrs:{id:"新增-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-7"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("新增了模式 "),e("code",[t._v("CACHE")]),t._v("，启用此模式后会缓存每次检查的结果，提高性能。")])]),t._v(" "),e("li",[e("p",[t._v("新增了配置 "),e("code",[t._v("waf_cache")]),t._v(" 用于设置缓存相关的参数。")])]),t._v(" "),e("li",[e("p",[t._v("新增了配置 "),e("code",[t._v("waf_cc_deny")]),t._v("，用于设置 CC 防护相关的参数。")])]),t._v(" "),e("li",[e("p",[t._v("新增了配置 "),e("code",[t._v("waf_priority")]),t._v("，用来设置除了 POST 检查以外所有的检查项目的优先级。")])]),t._v(" "),e("li",[e("p",[t._v("当 CC 防护返回 503 状态码时会附上 "),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Retry-After",target:"_blank",rel:"noopener noreferrer"}},[t._v("Retry-After"),e("OutboundLink")],1),t._v(" 响应头。")])])]),t._v(" "),e("h3",{attrs:{id:"移除-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除-3"}},[t._v("#")]),t._v(" 移除")]),t._v(" "),e("ul",[e("li",[t._v("废弃了配置 "),e("code",[t._v("waf_cc_deny_limit")]),t._v("，使用新的配置 "),e("code",[t._v("waf_cc_deny")]),t._v(" 替代。")])]),t._v(" "),e("h3",{attrs:{id:"变动-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-6"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("互换了 CC 防护和 IP 白名单检查的默认优先级。")])]),t._v(" "),e("h3",{attrs:{id:"修复-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-10"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修复了当 worker 进程数量大于一时的段错误。")])]),t._v(" "),e("li",[e("p",[t._v("修复了 CC 防护统计有时不准的错误。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_4-0-0-2021-03-22-gmt-0800"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-0-2021-03-22-gmt-0800"}},[t._v("#")]),t._v(" [4.0.0] - 2021-03-22 GMT+0800")]),t._v(" "),e("h3",{attrs:{id:"警告-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#警告-2"}},[t._v("#")]),t._v(" "),e("strong",[t._v("警告")])]),t._v(" "),e("p",[e("strong",[t._v("此版本包含不兼容的更新（breaking changes）。")])]),t._v(" "),e("h3",{attrs:{id:"新增-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-8"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("为 "),e("code",[t._v("waf_mode")]),t._v(" 和 "),e("code",[t._v("waf_cc_deny_limit")]),t._v(" 增加了一些参数（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/368db2b26e9d2a910c06e77f892740cefe9556d3",target:"_blank",rel:"noopener noreferrer"}},[t._v("368db2b"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"移除-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除-4"}},[t._v("#")]),t._v(" 移除")]),t._v(" "),e("ul",[e("li",[t._v("废弃配置项 "),e("code",[t._v("waf_mult_mount")]),t._v("，该配置的功能已经合并到了配置项 "),e("code",[t._v("waf_mode")]),t._v(" 中。")])]),t._v(" "),e("h3",{attrs:{id:"变动-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变动-7"}},[t._v("#")]),t._v(" 变动")]),t._v(" "),e("ul",[e("li",[t._v("给 "),e("code",[t._v("waf_mode")]),t._v(" 增加了一些参数。")])]),t._v(" "),e("h3",{attrs:{id:"修复-11"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-11"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("更正了内置变量 "),e("code",[t._v("waf_rule_details")]),t._v(" 的名称错误，该变量的名称在之前的版本代码中被设置为 "),e("code",[t._v("waf_rule_deatails")]),t._v("。")])]),t._v(" "),e("li",[e("p",[t._v("不再进行冗余的检测。")])]),t._v(" "),e("li",[e("p",[t._v("彻底解决了与 "),e("code",[t._v("ngx_http_rewrite_module")]),t._v(" 的兼容性问题。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-6-2021-03-07"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-2021-03-07"}},[t._v("#")]),t._v(" [3.1.6] - 2021-03-07")]),t._v(" "),e("h3",{attrs:{id:"修复-12"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-12"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("更正规则的生效顺序（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/51c7824786c060f4b0dcffe77a4a1e04b775e04b",target:"_blank",rel:"noopener noreferrer"}},[t._v("51c7824"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-5-2021-03-03"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-2021-03-03"}},[t._v("#")]),t._v(" [3.1.5] - 2021-03-03")]),t._v(" "),e("h3",{attrs:{id:"修复-13"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-13"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复了 "),e("code",[t._v("config")]),t._v(" 脚本的一个错误，这个错误会导致不能正确地检查依赖项（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/075a27e4f7aaf7e78c45eac0c78c9634863be476#diff-b79606fb3afea5bd1609ed40b622142f1c98125abcfe89a76a661b0e8e343910",target:"_blank",rel:"noopener noreferrer"}},[t._v("075a27e"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-4-2021-03-02"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-2021-03-02"}},[t._v("#")]),t._v(" [3.1.4] - 2021-03-02")]),t._v(" "),e("h3",{attrs:{id:"改动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[t._v("条件允许的情况下使用更安全的字符串处理函数以避免缓冲区溢出（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/177ae68cb019f47096e6065ec34aa0ef9be07567",target:"_blank",rel:"noopener noreferrer"}},[t._v("177ae68"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-3-2021-02-23"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-2021-02-23"}},[t._v("#")]),t._v(" [3.1.3] - 2021-02-23")]),t._v(" "),e("h3",{attrs:{id:"修复-14"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-14"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("改正规则的生效顺序（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/857ec84c6519d88d1c1a5560a244dceffd413f3f",target:"_blank",rel:"noopener noreferrer"}},[t._v("857ec84"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-2-2021-02-17"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-2021-02-17"}},[t._v("#")]),t._v(" [3.1.2] - 2021-02-17")]),t._v(" "),e("h3",{attrs:{id:"修复-15"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-15"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复了一个 bug，这个 bug 会导致当规则文件不具有可写权限时初始化失败（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/20acd27815d1f266d89c1557e93848c96117b8ff",target:"_blank",rel:"noopener noreferrer"}},[t._v("20acd27"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-1-2021-01-18"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-2021-01-18"}},[t._v("#")]),t._v(" [3.1.1] - 2021-01-18")]),t._v(" "),e("h3",{attrs:{id:"修复-16"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-16"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("兼容较低版本的 GCC（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/becbbe022b9f6efa606e720d7cbcd6c5d6f22c33",target:"_blank",rel:"noopener noreferrer"}},[t._v("becbbe0"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-1-0-2021-01-17"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-0-2021-01-17"}},[t._v("#")]),t._v(" [3.1.0] - 2021-01-17")]),t._v(" "),e("h3",{attrs:{id:"注意-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意-3"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),e("ul",[e("li",[t._v("因为在 "),e("code",[t._v("v3.0.3")]),t._v(" 测试过程中新增了向下兼容的功能，所以 "),e("code",[t._v("v3.0.3")]),t._v(" 被跳过。")])]),t._v(" "),e("h3",{attrs:{id:"新增-9"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-9"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("增加调试日志便于排障（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bac1d026e9e902d9a49881e899cba4965f3388a4",target:"_blank",rel:"noopener noreferrer"}},[t._v("bac1d02"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"修复-17"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-17"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修复了一个段错误（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/57d7719654caddc40ee655c797f0984f42c25495",target:"_blank",rel:"noopener noreferrer"}},[t._v("57d7719"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("li",[e("p",[t._v("更精确的访问频次统计（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/53d3b149a524252dbb9b8170e31f4b1f4895a6b7",target:"_blank",rel:"noopener noreferrer"}},[t._v("53d3b14"),e("OutboundLink")],1),t._v("）。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-0-2-2021-01-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-2-2021-01-10"}},[t._v("#")]),t._v(" [3.0.2] - 2021-01-10")]),t._v(" "),e("h3",{attrs:{id:"注意-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意-4"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),e("ul",[e("li",[t._v("因为在 "),e("code",[t._v("v3.0.1")]),t._v("上有热修复，所以 "),e("code",[t._v("v3.0.2")]),t._v(" 的一切测试版本作废，请不要使用这些测试版。")])]),t._v(" "),e("h3",{attrs:{id:"修复-18"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-18"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复一个了在 "),e("code",[t._v("Alpine Linux")]),t._v(" 下的编译错误（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/e989aa34370da73f03627601188ca33844372c4f",target:"_blank",rel:"noopener noreferrer"}},[t._v("e989aa3"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-0-1-2020-12-28"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-1-2020-12-28"}},[t._v("#")]),t._v(" [3.0.1] - 2020-12-28")]),t._v(" "),e("h3",{attrs:{id:"修复-19"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-19"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复了一个在检查 Cookie 时的段错误（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8dc2b56e9a8ae7c22cc5309ac0a060b0358f545b",target:"_blank",rel:"noopener noreferrer"}},[t._v("8dc2b56"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_3-0-0-2020-12-25"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-0-2020-12-25"}},[t._v("#")]),t._v(" [3.0.0] - 2020-12-25")]),t._v(" "),e("h3",{attrs:{id:"新增-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-10"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("CC 防御现在也支持了 IPV6（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/00fbc1c20ec964f6cd3bb992d756737e95b6c7ed",target:"_blank",rel:"noopener noreferrer"}},[t._v("00fbc1c"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("li",[e("p",[t._v("IP 黑白名单支持了 IPV6。可以识别形如 "),e("code",[t._v("fe80::/10")]),t._v(" 的 IPV6 字符串（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8519b26f5fb9491ac60ae084247a0957c0931d0c",target:"_blank",rel:"noopener noreferrer"}},[t._v("8519b26"),e("OutboundLink")],1),t._v("）。")])])]),t._v(" "),e("h3",{attrs:{id:"改动-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-2"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("删除了一些无用的日志（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bd279e7be872621fa75337722a9fae30b2ea6812",target:"_blank",rel:"noopener noreferrer"}},[t._v("bd279e7"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("li",[e("p",[t._v("友好的错误提示（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/d1185b26a413e45dcf5ef479b0078aa57a4b5962",target:"_blank",rel:"noopener noreferrer"}},[t._v("d1185b2"),e("OutboundLink")],1),t._v(" & "),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/f2b617d5174eb1bc6982113415ddcb1f798ef703",target:"_blank",rel:"noopener noreferrer"}},[t._v("f2b617d"),e("OutboundLink")],1),t._v("）。当规则文件中 IP 地址无效或者 IP 地址块重叠的时候警告或者报错（并不能检测所有的重叠情况）。")])]),t._v(" "),e("li",[e("p",[t._v("更快的 IP 地址检查速度（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/2b9e77404826666df301c3d6b3ce07a6968de266",target:"_blank",rel:"noopener noreferrer"}},[t._v("2b9e774"),e("OutboundLink")],1),t._v("）。改用前缀树检查 IP，现在在常数时间内即可完成 IP 的匹配，之前是一个一个地匹配，是线性时间。")])])]),t._v(" "),e("h3",{attrs:{id:"修复-20"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-20"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修复了 Cookie 检查的失效的 bug（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/87beed183e404c70411a2d35ea68ebbccccf5ff6",target:"_blank",rel:"noopener noreferrer"}},[t._v("87beed1"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("li",[e("p",[t._v("修改 "),e("code",[t._v("config")]),t._v(" 文件以确保执行 "),e("code",[t._v("make")]),t._v(" 或 "),e("code",[t._v("make modules")]),t._v(" 时最新的模块代码能够被编译（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/25f97f5e7f3792b131ab0ebb1bfe4b7fe5e330ae",target:"_blank",rel:"noopener noreferrer"}},[t._v("25f97f5"),e("OutboundLink")],1),t._v("）。在修复之前，如果仅仅 "),e("code",[t._v("inc/")]),t._v(" 下的文件发生变化，编译时不会将最新的代码编译进去，因为没有检查 "),e("code",[t._v("inc/")]),t._v(" 下的文件是否发生变化。")])]),t._v(" "),e("li",[e("p",[t._v("修复了 IPV4 网段识别错误的 bug（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/73a22eb3538a24e9714bf8331946a5654df20cc1",target:"_blank",rel:"noopener noreferrer"}},[t._v("73a22eb"),e("OutboundLink")],1),t._v("）。这个 bug 可能会导致当规则中出现类似 "),e("code",[t._v("192.168.0.0/10")]),t._v("，即后缀不是 8 的倍数的时候无法正确生成子网掩码。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_2-1-1-2020-12-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-2020-12-10"}},[t._v("#")]),t._v(" [2.1.1] - 2020-12-10")]),t._v(" "),e("h3",{attrs:{id:"新增-11"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-11"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("h3",{attrs:{id:"改动-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-3"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("h3",{attrs:{id:"修复-21"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-21"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复了模块启动失败的 bug。此 bug 的报错信息为 "),e("code",[t._v('nginx: [alert] could not open error log file: open() "ngx_waf: /logs/error.log" failed (2: No such file or directory)')]),t._v("（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/0dfc46f2dfc7ed91977b501c868abf961966d4e1",target:"_blank",rel:"noopener noreferrer"}},[t._v("0dfc46f"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_2-1-0-2020-12-09"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-0-2020-12-09"}},[t._v("#")]),t._v(" [2.1.0] - 2020-12-09")]),t._v(" "),e("h3",{attrs:{id:"新增-12"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-12"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("兼容了 Mainline 版本的 nginx（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/f31f906b11fb00f54bfea504ca7c8c147a0be1d8",target:"_blank",rel:"noopener noreferrer"}},[t._v("f31f906"),e("OutboundLink")],1),t._v(" & "),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/7b4f897a4a332b43bf94de874f8ba8c3098aaee4",target:"_blank",rel:"noopener noreferrer"}},[t._v("65277d1"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"改动-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-4"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("h3",{attrs:{id:"修复-22"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-22"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("h2",{attrs:{id:"_2-0-2-2020-12-07"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-2-2020-12-07"}},[t._v("#")]),t._v(" [2.0.2] - 2020-12-07")]),t._v(" "),e("h3",{attrs:{id:"新增-13"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-13"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("h3",{attrs:{id:"改动-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-5"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("h3",{attrs:{id:"修复-23"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-23"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("修复了一个 CC 防御失效的 bug。此 bug 会导致当 "),e("code",[t._v("waf_mult_mount")]),t._v(" 未启用时，CC 防御会失效（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/048fe5c15863d9a3106387225774305aa5564726",target:"_blank",rel:"noopener noreferrer"}},[t._v("048fe5c"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("li",[e("p",[t._v("修复了一个因错误的 "),e("code",[t._v("#include")]),t._v(" 指令而导致编译失败的 bug（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3fa298c6184618ea0cd6336783a4d7a2ed27469c",target:"_blank",rel:"noopener noreferrer"}},[t._v("3fa298c"),e("OutboundLink")],1),t._v("）。")])])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_2-0-1-2020-12-03"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-1-2020-12-03"}},[t._v("#")]),t._v(" [2.0.1] - 2020-12-03")]),t._v(" "),e("h3",{attrs:{id:"新增-14"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-14"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("h3",{attrs:{id:"改动-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-6"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[t._v("不再手动下载 uthash 依赖，改用 system library。可以使用 "),e("code",[t._v("yum install uthash-devel")]),t._v(" 或 "),e("code",[t._v("apt-get install uthash-dev")]),t._v(" 安装 system library（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/7cfc94bc64fa4f2c29bdf3b24e21aeb1ba412054",target:"_blank",rel:"noopener noreferrer"}},[t._v("7cfc94b"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"修复-24"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-24"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复了因为宏的重定义导致的在 CentOS/RHEL 6 or 7 下编译失败的错误（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/28e1c8aca03375089c75df21c5db3c38013edde7",target:"_blank",rel:"noopener noreferrer"}},[t._v("28e1c8a"),e("OutboundLink")],1),t._v(" & "),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/566ae4a50f855674b256db84305a24e1b2a6bc6d",target:"_blank",rel:"noopener noreferrer"}},[t._v("566ae4a"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_2-0-0-2020-09-29"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-0-2020-09-29"}},[t._v("#")]),t._v(" [2.0.0] - 2020-09-29")]),t._v(" "),e("h3",{attrs:{id:"新增-15"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-15"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("支持以动态模块安装到 nginx 上，感谢 "),e("a",{attrs:{href:"https://github.com/dvershinin",target:"_blank",rel:"noopener noreferrer"}},[t._v("dvershinin"),e("OutboundLink")],1),t._v("的 PR（https://github.com/ADD-SP/ngx_waf/pull/4）。")])]),t._v(" "),e("h3",{attrs:{id:"改动-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-7"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[t._v("配置指令合并 ("),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/ba92cfd53ce78da8ff4ed22d2bc71a47de4cbe25",target:"_blank",rel:"noopener noreferrer"}},[t._v("ba92cfd"),e("OutboundLink")],1),t._v(")。这些配置指令将被合并："),e("code",[t._v("waf_check_ipv4")]),t._v("，"),e("code",[t._v("waf_check_url")]),t._v("，"),e("code",[t._v("waf_check_args")]),t._v("，"),e("code",[t._v("waf_check_ua")]),t._v("，"),e("code",[t._v("waf_check_referer")]),t._v("，"),e("code",[t._v("waf_check_cookie")]),t._v("，"),e("code",[t._v("waf_check_post")]),t._v("，"),e("code",[t._v("waf_check_cookie")]),t._v("，"),e("code",[t._v("waf_cc_deny")]),t._v("。合并后的新指令为"),e("code",[t._v("waf_mode")]),t._v("，详情见"),e("RouterLink",{attrs:{to:"/zh-cn/advance/README-ZH.html"}},[t._v("README")]),t._v("。")],1)]),t._v(" "),e("h3",{attrs:{id:"修复-25"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-25"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("删除一个默认的 User-Agent 规则，规则内容为"),e("code",[t._v("(?i)(?:Sogou web spider)")]),t._v("，原因是会拦截非恶意的网络爬虫（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/827d4e5bc48894ff9147e49799d3a9656fe7dd8a",target:"_blank",rel:"noopener noreferrer"}},[t._v("827d4e5"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("现在可以正确处理规则文件中的空行了（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/955cf2d240c4d66f815890e3ee9b88ccf906cf1d",target:"_blank",rel:"noopener noreferrer"}},[t._v("955cf2d"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_1-0-1-2020-08-22"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-1-2020-08-22"}},[t._v("#")]),t._v(" [1.0.1] - 2020-08-22")]),t._v(" "),e("h3",{attrs:{id:"新增-16"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-16"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("增加了新的配置项（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3214fc88d565ed47daa4bdac4f0edb7d1785ed75",target:"_blank",rel:"noopener noreferrer"}},[t._v("3214fc8"),e("OutboundLink")],1),t._v("）\n"),e("ul",[e("li",[t._v("waf_check_ipv4:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_ipv4 [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 IPV4 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_url:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_url [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 URL 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_args:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_args [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 Args 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_ua:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_ua [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 User-Agent 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_referer:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_referer [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 Referer 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_cookie:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_cookie [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("on")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 Cookie 检查。")])])]),t._v(" "),e("li",[t._v("waf_check_post:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_check_post [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("off")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 POST 检查。")])])]),t._v(" "),e("li",[t._v("waf_cc_deny:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_cc_deny [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("off")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用 CC 防御。")])])])])])]),t._v(" "),e("h3",{attrs:{id:"改动-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-8"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("waf_mult_mount")]),t._v("现在只允许写在"),e("code",[t._v("server")]),t._v("段中（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3214fc88d565ed47daa4bdac4f0edb7d1785ed75",target:"_blank",rel:"noopener noreferrer"}},[t._v("3214fc8"),e("OutboundLink")],1),t._v("）。\n"),e("ul",[e("li",[t._v("waf_mult_mount:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_mult_mount [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("off")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：进行多阶段检查，当"),e("code",[t._v("nginx.conf")]),t._v("存在地址重写的情况下（如"),e("code",[t._v("rewrite")]),t._v("配置）建议启用，反之建议关闭。")])])])])]),t._v(" "),e("li",[t._v("更改现有的配置项关键字，删除了"),e("code",[t._v("ngx_")]),t._v("前缀（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/8b3e416cdfdc7e073a3392fc9ec027a4138af453",target:"_blank",rel:"noopener noreferrer"}},[t._v("8b3e416"),e("OutboundLink")],1),t._v("）。\n"),e("ul",[e("li",[t._v("waf:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("off")])]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：是否启用本模块。")])])]),t._v(" "),e("li",[t._v("waf_rule_path:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_rule_path dir;")])]),t._v(" "),e("li",[t._v("默认值：无")]),t._v(" "),e("li",[t._v("配置段: server")]),t._v(" "),e("li",[t._v("作用：规则文件所在目录，且必须以"),e("code",[t._v("/")]),t._v("结尾。")])])]),t._v(" "),e("li",[t._v("waf_mult_mount:\n"),e("ul",[e("li",[t._v("配置语法: "),e("code",[t._v("waf_mult_mount [ on | off ];")])]),t._v(" "),e("li",[t._v("默认值："),e("code",[t._v("off")])]),t._v(" "),e("li",[t._v("配置段: http")]),t._v(" "),e("li",[t._v("作用：进行多阶段检查，当"),e("code",[t._v("nginx.conf")]),t._v("存在地址重写的情况下（如"),e("code",[t._v("rewrite")]),t._v("配置）建议启用，反之建议关闭。")])])])])]),t._v(" "),e("li",[t._v("更新 referer 的默认规则，具体一点就是拷贝"),e("code",[t._v("rules/url")]),t._v("的内容到"),e("code",[t._v("rules/referer")]),t._v("中（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/55f5e26b6135af382b1db88057f5143631848ae7",target:"_blank",rel:"noopener noreferrer"}},[t._v("55f5e26"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"修复-26"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-26"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("修复 CC 防御功能检测逻辑的错误，该错误会导致实际的频率限制要远小于用户指定的限制，容易将正常访问识别为 CC 攻击（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/9cb51bba0cdf10c2fd1ac0a482d7435dcfdee93d",target:"_blank",rel:"noopener noreferrer"}},[t._v("9cb51bb"),e("OutboundLink")],1),t._v("）（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/171721cee861022e9f3db5fceeb16051b90a5e54",target:"_blank",rel:"noopener noreferrer"}},[t._v("171721c"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("现在会检查 rules/ipv4 和 rules/white-ipv4 这两个文件中的 IPV4 地址或地址块是否合法（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/fc09f045d1e9ac774a919181a15c20a6c777a276",target:"_blank",rel:"noopener noreferrer"}},[t._v("fc09f04"),e("OutboundLink")],1),t._v("）（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/2e7f624581d8d85a23d6470acced9acc3e2840b2",target:"_blank",rel:"noopener noreferrer"}},[t._v("2e7f624"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"_1-0-0-2020-08-18"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-0-2020-08-18"}},[t._v("#")]),t._v(" [1.0.0] - 2020-08-18")]),t._v(" "),e("h3",{attrs:{id:"新增-17"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-17"}},[t._v("#")]),t._v(" 新增")]),t._v(" "),e("ul",[e("li",[t._v("改进日志格式（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bd112ecacd9356ee1e0731634cfc197034d25c88",target:"_blank",rel:"noopener noreferrer"}},[t._v("bd112ec"),e("OutboundLink")],1),t._v("）。基本格式为"),e("code",[t._v("xxxxx, ngx_waf: [拦截类型][对应规则], xxxxx")]),t._v("，具体可看下面的例子。"),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('2020/01/20 22:56:30 [alert] 24289#0: *30 ngx_waf: [BLACK-URL][(?i)(?:/\\.env$)], client: 192.168.1.1, server: example.com, request: "GET /v1/.env HTTP/1.1", host: "example.com", referrer: "http:/example.com/v1/.env"\n\n2020/01/20 22:58:40 [alert] 24678#0: *11 ngx_waf: [BLACK-POST][(?i)(?:select.*(?:from|limit))], client: 192.168.1.1, server: example.com, request: "POST /xmlrpc.php HTTP/1.1", host: "example.com", referrer: "https://example.com/"\n')])])])]),t._v(" "),e("li",[t._v("新增三个内置变量（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/92d6d847840ada57bbc54ffe2c0980b118a37a30",target:"_blank",rel:"noopener noreferrer"}},[t._v("92d6d84"),e("OutboundLink")],1),t._v("）\n"),e("ul",[e("li",[e("code",[t._v("$waf_blocked")]),t._v(": 本次请求是否被本模块拦截，如果拦截了则其的值为"),e("code",[t._v("'true'")]),t._v(",反之则为"),e("code",[t._v("'false'")]),t._v("。")]),t._v(" "),e("li",[e("code",[t._v("$waf_rule_type")]),t._v("：如果本次请求被本模块拦截，则其值为触发的规则类型。下面是可能的取值。若没有生效则其值为"),e("code",[t._v("'null'")]),t._v("。\n"),e("ul",[e("li",[e("code",[t._v("'BLACK-IPV4'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-URL'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-ARGS'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-USER-AGENT'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-REFERER'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-COOKIE'")])]),t._v(" "),e("li",[e("code",[t._v("'BLACK-POST'")])])])]),t._v(" "),e("li",[e("code",[t._v("'$waf_rule_details'")]),t._v("：如果本次请求被本模块拦截，则其值为触发的具体的规则的内容。若没有生效则其值为"),e("code",[t._v("'null'")]),t._v("。")])])]),t._v(" "),e("li",[t._v("支持过滤 POST 请求（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/b46641eb8473c6dcb6afe9ed73f94712300d176f",target:"_blank",rel:"noopener noreferrer"}},[t._v("b46641e"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("新配置项"),e("code",[t._v("ngx_waf_mult_mount")]),t._v("用于增加拦截面（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/e1b500de349e017b67f334878342bdd6a34d22b8",target:"_blank",rel:"noopener noreferrer"}},[t._v("e1b500d"),e("OutboundLink")],1),t._v("），典型的应用场景是存在"),e("code",[t._v("rewrite")]),t._v("的情况下重写前后均会对 URL 进行一次检测。")]),t._v(" "),e("li",[t._v("支持 CC 防御功能（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3a93e190b8cb78fcd7a0197f76298c010169d113",target:"_blank",rel:"noopener noreferrer"}},[t._v("3a93e19"),e("OutboundLink")],1),t._v("）。")])]),t._v(" "),e("h3",{attrs:{id:"改动-9"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#改动-9"}},[t._v("#")]),t._v(" 改动")]),t._v(" "),e("ul",[e("li",[t._v("增加默认的 POST 过滤规则（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/68dd102e011acfd819669d60a35d315365d26a16",target:"_blank",rel:"noopener noreferrer"}},[t._v("68dd102"),e("OutboundLink")],1),t._v("）")]),t._v(" "),e("li",[t._v("更新默认规则（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/55f0a4824bafb67f562909bdb58292cfce1059ae",target:"_blank",rel:"noopener noreferrer"}},[t._v("55f0a48"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("修改规则优先级（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/3c388c85e30528b66306ca780524c7d663277f07",target:"_blank",rel:"noopener noreferrer"}},[t._v("3c388c8"),e("OutboundLink")],1),t._v("）（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/248958d3a0ef27dd14acc63a503e97931841f18a",target:"_blank",rel:"noopener noreferrer"}},[t._v("248958d"),e("OutboundLink")],1),t._v("）（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/b46641eb8473c6dcb6afe9ed73f94712300d176f",target:"_blank",rel:"noopener noreferrer"}},[t._v("b46641e"),e("OutboundLink")],1),t._v("）（(92447a3)[https://github.com/ADD-SP/ngx_waf/commit/92447a39d6a36ab027b0ead0daa0fe2b3b74ff29]），现在的优先级为（靠上的优先生效）：\n"),e("ol",[e("li",[t._v("IP 白名单")]),t._v(" "),e("li",[t._v("IP 黑名单")]),t._v(" "),e("li",[t._v("CC 防御")]),t._v(" "),e("li",[t._v("URL 白名单")]),t._v(" "),e("li",[t._v("URL 黑名单")]),t._v(" "),e("li",[t._v("Args 黑名单")]),t._v(" "),e("li",[t._v("UserAgent 黑名单")]),t._v(" "),e("li",[t._v("Referer 白名单")]),t._v(" "),e("li",[t._v("Referer 黑名单")]),t._v(" "),e("li",[t._v("Cookie 黑名单")]),t._v(" "),e("li",[t._v("POST 黑名单")])])])]),t._v(" "),e("h3",{attrs:{id:"修复-27"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修复-27"}},[t._v("#")]),t._v(" 修复")]),t._v(" "),e("ul",[e("li",[t._v("IPV4 黑白名单功能失效（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/231f94aa5383fe8f6cdc0fbc3cd2dcadb7606881",target:"_blank",rel:"noopener noreferrer"}},[t._v("231f94a"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("当 User-agent 为空时会触发 segmentation fault（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/bf33b366232b7f5e05379d5e10ab006696189ea6",target:"_blank",rel:"noopener noreferrer"}},[t._v("bf33b36"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("li",[t._v("启用 CC 防御后会有内存泄漏（"),e("a",{attrs:{href:"https://github.com/ADD-SP/ngx_waf/commit/be58d189b4c95be066623604124b02a9bf174e7f",target:"_blank",rel:"noopener noreferrer"}},[t._v("be58d18"),e("OutboundLink")],1),t._v("）。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);